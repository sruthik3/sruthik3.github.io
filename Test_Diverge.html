<!doctype html>
<html>
<head>
    <style>
        .y-axis line{ stroke: black;}
        .annual-growth { fill: black;}
        .bar-label, .x-axis{ font-size:8px}
        .domain, .tick line{ opacity: 0.5}
    </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
</head>
<body>
<svg width="800" height="800"></svg>
<script>
    var margin = {top: 40, right: 50, bottom: 60, left: 50};
    
    var width = 960 - margin.left - margin.right,
    		height = 500 - margin.top - margin.bottom;
    
    var svg = d3.select("body").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
    // Config
    var cfg = {
      labelMargin: 5,
      xAxisMargin: 10,
      legendRightMargin: 0
    }
    
    var x = d3.scaleLinear()
    	.range([0, width]);
     
    var colour = d3.scaleSequential(d3.interpolatePRGn);


    var y = d3.scaleBand()
    	.range([height, 0])
    	.padding(0.1);
    
    function parse(d) {
      d.annual_growth = +d.Value;
      return d;
    }
    
    var legend = svg.append("g")
    	.attr("class", "legend");
/*xScale.domain([1900,2020]);
yScale.domain([-0.60,1.80]);*/

legend.append("text")
    	.attr("x", width - cfg.legendRightMargin)
    	.attr("text-anchor", "end")
    	.text("Years");
    
    legend.append("text")
      .attr("x", width - cfg.legendRightMargin)
    	.attr("y", 20)
    	.attr("text-anchor", "end")
    	.style("opacity", 0.5)
    	.text("Global Surface Temperature growth");
    
    d3.csv("https://sruthik3.github.io/Global_Temp.csv", parse, function(error, data) {
      if (error) throw error;
      
      data = data.filter(function(d) {
              return d.Year > "1920";})
      y.domain(data.map(function(d) { return d.Year; }));
      x.domain(d3.extent(data, function(d) { return d.Value; }));
      
      var max = d3.max(data, function(d) { return d.Value; });
      colour.domain([-max, max]);
      
      var yAxis = svg.append("g")
      	.attr("class", "y-axis")
      	.attr("transform", "translate(" + x(0) + ",0)")
      	.append("line")
          .attr("y1", 0)
          .attr("y2", height);
      
      var xAxis = svg.append("g")
      	.attr("class", "x-axis")
      	.attr("transform", "translate(0," + (height + cfg.xAxisMargin) + ")")
      	.call(d3.axisBottom(x).tickSizeOuter(0));
      
      var bars = svg.append("g")
      	.attr("class", "bars")
      
      bars.selectAll("rect")
      	.data(data)
      .enter().append("rect")
      	.attr("class", "annual-growth")
      	.attr("x", function(d) {
       		return x(Math.min(0, d.Value));
      	})
      	.attr("y", function(d) { return y(d.Year); })
      	.attr("height", y.bandwidth())
      	.attr("width", function(d) { 
        	return Math.abs(x(d.Value) - x(0))
      	})
      	.style("fill", function(d) {
        	return colour(d.Value)
      	});
      
      var labels = svg.append("g")
      	.attr("class", "labels");
      
      labels.selectAll("text")
      	.data(data)
      .enter().append("text")
      	.attr("class", "bar-label")
      	.attr("x", x(0))
      	.attr("y", function(d) { return y(d.Year )})
      	.attr("dx", function(d) {
        	return d.Value < 0 ? cfg.labelMargin : -cfg.labelMargin;
      	})
      	.attr("dy", y.bandwidth())
      	.attr("text-anchor", function(d) {
        	return d.Value < 0 ? "start" : "end";
      	})
      	.text(function(d) { return d.Year })
      	});
</script>
</body>
</html>